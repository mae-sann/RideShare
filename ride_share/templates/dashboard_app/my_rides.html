{% extends 'dashboard_app/dashboard.html' %}
{% load static %}

{% block title %}My Posted Rides{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/find_rides.css' %}">
<style>
    .request-box {
        background-color: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 12px;
        margin-top: 12px;
    }
    .request-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid #e2e8f0;
    }
    .request-item:last-child { border-bottom: none; }
    .btn-action {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        border: none;
        text-decoration: none;
        display: inline-block;
    }
    .btn-accept { background: #10b981; color: white; margin-right: 4px; }
    .btn-decline { background: #ef4444; color: white; }
    .btn-complete { background: #3b82f6; color: white; width: 100%; margin-top: 10px; }
</style>

<div class="find-rides-container">
    <div class="page-header">
        <h1><i class="fa-solid fa-car"></i> My Posted Rides</h1>
    </div>

    <div class="rides-grid">
        {% if rides %}
            {% for ride in rides %}
            <div class="ride-card">
                <div class="ride-info">
                    <div class="ride-header">
                        <div class="driver-name">From {{ ride.origin }} to {{ ride.destination }}</div>
                    </div>
                    <div class="ride-meta">
                        <span><i class="fa-regular fa-calendar"></i> {{ ride.start_date }}</span>
                        <span><i class="fa-regular fa-clock"></i> {{ ride.start_time }}</span>
                        <span class="status {{ ride.status }}">{{ ride.status|title }}</span>
                    </div>
                </div>

                <div class="ride-actions">
                    {% if ride.status == 'open' or ride.status == 'full' %}
                        <form method="POST" action="{% url 'complete_ride' ride.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn-request btn-complete">
                                <i class="fa-solid fa-flag-checkered"></i> Mark as Completed
                            </button>
                        </form>
                        
                        <div class="request-box">
                            <strong>Pending Requests:</strong>
                            {% if ride.bookings.all %}
                                {% for booking in ride.bookings.all %}
                                    {% if booking.status == 'pending' %}
                                    <div class="request-item">
                                        <span>{{ booking.passenger.first_name }} ({{ booking.num_seats }} seats)</span>
                                        <div>
                                            <a href="{% url 'accept_booking' booking.id %}" class="btn-action btn-accept">Accept</a>
                                            <a href="{% url 'decline_booking' booking.id %}" class="btn-action btn-decline">Decline</a>
                                        </div>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <p style="font-size: 12px; color: #64748b;">No pending requests.</p>
                            {% endif %}
                        </div>
                    {% else %}
                            <button class="btn-request" disabled style="opacity: 0.6;">Ride {{ ride.status|title }}</button>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="no-results">
                <h3>No Rides Posted</h3>
                <a href="{% url 'post_ride' %}" class="btn-request">Post a Ride</a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}